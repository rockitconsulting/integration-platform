<?xml version="1.0" encoding="UTF-8"?>
<ecore:EPackage xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:ComIbmCompute.msgnode="ComIbmCompute.msgnode" xmlns:ComIbmMQGet.msgnode="ComIbmMQGet.msgnode" xmlns:ComIbmMQOutput.msgnode="ComIbmMQOutput.msgnode" xmlns:ComIbmTimeoutNotification.msgnode="ComIbmTimeoutNotification.msgnode" xmlns:ErrorHandler.subflow="ErrorHandler.subflow" xmlns:ecore="http://www.eclipse.org/emf/2002/Ecore" xmlns:eflow="http://www.ibm.com/wbi/2005/eflow" xmlns:utility="http://www.ibm.com/wbi/2005/eflow_utility"
    nsURI="com/rockit/ip/scheduler/CronManager.msgflow" nsPrefix="com_rockit_ip_scheduler_CronManager.msgflow">
  <eClassifiers xmi:type="eflow:FCMComposite" name="FCMComposite_1">
    <eSuperTypes href="http://www.ibm.com/wbi/2005/eflow#//FCMBlock"/>
    <eStructuralFeatures xmi:type="ecore:EAttribute" xmi:id="Property.ConfigQueue" name="ConfigQueue" lowerBound="1" defaultValueLiteral="SCHEDULE.CFG.01">
      <eType xmi:type="ecore:EDataType" href="http://www.eclipse.org/emf/2002/Ecore#//EString"/>
    </eStructuralFeatures>
    <translation xmi:type="utility:TranslatableString" key="CronManager" bundleName="com/rockit/ip/scheduler/CronManager" pluginId="IIB-Scheduler"/>
    <colorGraphic16 xmi:type="utility:GIFFileGraphic" resourceName="platform:/plugin/IIB-Scheduler/icons/full/obj16/CronManager.gif"/>
    <colorGraphic32 xmi:type="utility:GIFFileGraphic" resourceName="platform:/plugin/IIB-Scheduler/icons/full/obj30/CronManager.gif"/>
    <shortDescription xmi:type="utility:ConstantString" string="Cronscheduler auf MQ Basis"/>
    <longDescription xmi:type="utility:ConstantString" string="----------------------------------------------------------------------------------------------------------&#xD;&#xA;----------------------------------------------------------------------------------------------------------&#xD;&#xA;----------------------------------------------------------------------------------------------------------&#xD;&#xA;&#xD;&#xA;Beschreibung&#xD;&#xA;&#xD;&#xA;Dieser Flow uebernimmt folgende Aufgaben:  &#xD;&#xA;1. Eine Konfigurationsnachricht mit Triggerbeschreibungen (id, pattern, destinationQueue) wird regelmaeßig aus der Konfig-Queue ausgelesen&#xD;&#xA;2. Die Cron basierten Trigger werden im ersten Lauf mit NextExecutionDate initialisiert, bei den weiteren anhand von NextExecutionDate auf die Faelligkeit geprueft&#xD;&#xA;3. Die Partnerapplikationen werden über in der Konfiguration spezifiziereten Ziel-Queues benachrichtigt&#xD;&#xA;4. Die Konfiguration wird mit NextExecutionTime geupdated und in die Konfig-Queue zurückgelegt&#xD;&#xA;&#xD;&#xA;----------------------------------------------------------------------------------------------------------&#xD;&#xA;----------------------------------------------------------------------------------------------------------&#xD;&#xA;----------------------------------------------------------------------------------------------------------&#xD;&#xA;&#xD;&#xA;Konfiguration&#xD;&#xA;&#xD;&#xA;Overridable Properties:&#xD;&#xA;&#xD;&#xA;PollingTimer.timeoutInterval = 10 &#xD;&#xA;ReadConfigFromMq.queueName = XZ0.MBVM.U.SCHEDULER.CONFIG.01 &#xD;&#xA;UpdateConfigToMQ.queueName = XZ0.MBVM.U.SCHEDULER.CONFIG.01 &#xD;&#xA;&#xD;&#xA;Flow-Prefix(für alle Properties zu verwenden): &#xD;&#xA;com.daimler.mbvm.scheduler.CronManager#&#xD;&#xA;&#xD;&#xA;Konfiguration-XML:&#xD;&#xA;&#xD;&#xA;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?>&#xD;&#xA;&lt;schedulerMessage xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&#xD;&#xA;&#x9;xsi:noNamespaceSchemaLocation=&quot;schedulerMessage.xsd&quot;>&#xD;&#xA;&#x9;&lt;schedulerRecord>&#xD;&#xA;&#x9;&#x9;&lt;schedulerId>Id1&lt;/schedulerId>&#xD;&#xA;&#x9;&#x9;&lt;brokerName>xyz&lt;/brokerName>&#xD;&#xA;&#x9;&#x9;&lt;cronPattern>0-59 0-59 0-23 * * *&lt;/cronPattern>&#xD;&#xA;&#x9;&#x9;&lt;queueName>XZ0.MBVM.U.AMETRAS.FLEET.TRIGGER.01&lt;/queueName>&#xD;&#xA;&#x9;&lt;/schedulerRecord>&#xD;&#xA;&#x9;&lt;schedulerRecord>&#xD;&#xA;&#x9;&#x9;&lt;schedulerId>Id2&lt;/schedulerId>&#xD;&#xA;&#x9;&#x9;&lt;brokerName>xyz&lt;/brokerName>&#xD;&#xA;&#x9;&#x9;&lt;cronPattern>0 0 8-10 * * *&lt;/cronPattern>&#xD;&#xA;&#x9;&#x9;&lt;queueName>XZ0.MBVM.U.AMETRAS.FLEET.TRIGGER.01&lt;/queueName>&#x9;&#xD;&#xA;&#x9;&lt;/schedulerRecord>&#xD;&#xA;&lt;/schedulerMessage>&#xD;&#xA;&#xD;&#xA;----------------------------------------------------------------------------------------------------------&#xD;&#xA;----------------------------------------------------------------------------------------------------------&#xD;&#xA;----------------------------------------------------------------------------------------------------------&#xD;&#xA;&#xD;&#xA;Cron-Patterns erklaert&#xD;&#xA;&#xD;&#xA;Die XML-Konfigurationsdatei enthaelt die Cron-Patterns. Aus Cron-Patterns wird das naechste Ausführungsdatum (nextExecutionDate) generiert. Die Textplatzhalter in Cron-Patterns haben folgende Funktionen:&#xD;&#xA;&#xD;&#xA;*   *  *   *  *  *  *&#xD;&#xA;|   |   |   |   |  |   |&#xD;&#xA;|   |   |   |   |  |   ' Tag der Woche (01 bis 07 entspricht Mo. bis So.) &#xD;&#xA;|   |   |   |   |  ' Jahr (z.B. 2222)&#xD;&#xA;|   |   |   |   ' Monat (01 bis 12 entspricht Jan. bis Dez.)&#xD;&#xA;|   |   |   ' Tag (01 bis 31)&#xD;&#xA;|   |   ' Stunde (00 bis 24)&#xD;&#xA;|   ' Minute (00 bis 59)&#xD;&#xA;' Sekunde (00 bis 59)&#xD;&#xA;&#xD;&#xA;Typische Cron-Patterns:&#xD;&#xA;&#xD;&#xA;1. 09.00 Uhr, taeglich:&#xD;&#xA;* 00 09 * * *&#xD;&#xA;&#xD;&#xA;2.  12.30 Uhr, taeglich:&#xD;&#xA;* 30 12  * * *&#xD;&#xA;&#xD;&#xA;3. 12.00 und 15.00 Uhr, taeglich &#xD;&#xA;* 00 12,15 * * *&#xD;&#xA;&#xD;&#xA;4. Alle 5 Minuten von 12.00 bis 12.55 Uhr, taeglich &#xD;&#xA;* 0/5 12 * * *&#xD;&#xA;&#xD;&#xA;5. Um 12.00, 12.01, 12.02, 12.03, 12.04, 12.05 Uhr, taeglich &#xD;&#xA;00 0-5 12 * * *&#xD;&#xA;&#xD;&#xA;6. 12.00, Mo.-Fr.&#xD;&#xA;* 00 12 * * 1-5&#xD;&#xA;&#xD;&#xA;7. 12.00, Sa.-So.&#xD;&#xA;* 00 12 * * 6,7&#xD;&#xA;&#xD;&#xA;8. Vierteljaehrlich, (am 1.1, 1.4, 1.7 und 1.10) um 09.00 Uhr&#xD;&#xA;* 00 09 01 01,04,07,10 *&#xD;&#xA;&#xD;&#xA;9. Halbjaehrlich, (am 1.1, 1.7) um 09.00 Uhr&#xD;&#xA;* 00 09 01 01,07 *&#xD;&#xA;&#xD;&#xA;10. Jaehrlich, (am 1.1) um 09.00 Uhr&#xD;&#xA;* 00 09 01 01 *&#xD;&#xA;&#xD;&#xA;----------------------------------------------------------------------------------------------------------&#xD;&#xA;----------------------------------------------------------------------------------------------------------&#xD;&#xA;----------------------------------------------------------------------------------------------------------&#xD;&#xA;&#xD;&#xA;Anmerkungen&#xD;&#xA;&#xD;&#xA;1. Aktuelle Implementierung von CronScheduler ist nicht klusterfaehig und darf nur auf einem Broker-Knoten (Batch-Broker) installiert werden.&#xD;&#xA;&#xD;&#xA;----------------------------------------------------------------------------------------------------------&#xD;&#xA;----------------------------------------------------------------------------------------------------------&#xD;&#xA;----------------------------------------------------------------------------------------------------------"/>
    <version xmi:type="utility:ConstantString" string="CronManager 1.0"/>
    <composition>
      <nodes xmi:type="ComIbmTimeoutNotification.msgnode:FCMComposite_1" xmi:id="FCMComposite_1_1" location="41,92" uniqueIdentifier="MbvnPoll" timeoutInterval="5">
        <translation xmi:type="utility:ConstantString" string="PollingTimer"/>
        <longDescription xmi:type="utility:ConstantString" string="Hier wird das Zeitintervall (die Frequenz) für Poll-Nachricht konfiguriert. Laut dieser Konfiguration wird regelmäßig die Poll-Nachricht über das Terminal &quot;Out&quot; abgesendet. Diese Frequenz definiert die Regelmäßigkeit der Versuche, die Trigger-Nachricht aus einer Queue abzulesen.&#xD;&#xA;&#xD;&#xA;ErrorHandler-Subflow ist an das &quot;Catch&quot; Terminal angeschlossen: das bedeutet dass die Fehler in diesem Flow von dem ErrorHandler behandelt werden und kein erfolgreicher Abschluss der Transaktionen ohne erfolgreiche Fehlerbehandlung möglich ist."/>
      </nodes>
      <nodes xmi:type="ComIbmCompute.msgnode:FCMComposite_1" xmi:id="FCMComposite_1_6" location="406,94" computeExpression="esql://routine/com.rockit.ip.scheduler#CronManager_CreateTriggerMessage.Main" computeMode="destinationAndMessage">
        <translation xmi:type="utility:ConstantString" string="CreateTriggerMessage"/>
        <longDescription xmi:type="utility:ConstantString" string="Hier wird:&#xD;&#xA;a) wenn die NextExecutionDate in entsprechendem Scheduler in der Konfigurationsdatei da ist, wird diese mit jetzigem Moment (NOW) vergliechen&#xD;&#xA;aa) falls NOW später oder gleich wie NextExecutionDate ist, wird die Konfigurationsnachricht als Triggernachricht in die konfigurierte Queue weitergeleitet (ohne Validierungen der Struktur oder Änderungen).&#xD;&#xA;ab) falls NOW früher als NextExecutionDate ist, wird die Konfigurationsnachricht in die ursprüngliche zurück gesendet.&#xD;&#xA;b) wenn NextExecutionDate in Konfigurationsnachricht nicht anwesend ist, wird NextExecutionDate anhand von dem entsprechenden CronPattern generiert und in den entsprechenden XML-Block eingebaut, danach wird die Konfigurationsnachricht in die ursprüngliche Queue gesendet."/>
      </nodes>
      <nodes xmi:type="ComIbmMQOutput.msgnode:FCMComposite_1" xmi:id="FCMComposite_1_7" location="592,95" destinationMode="list">
        <translation xmi:type="utility:ConstantString" string="WriteTriggerToMqDestList"/>
        <longDescription xmi:type="utility:ConstantString" string="Hier wird die Triggernachricht in die entsprechende Queue gesendet."/>
      </nodes>
      <nodes xmi:type="ComIbmMQOutput.msgnode:FCMComposite_1" xmi:id="FCMComposite_1_8" location="604,193" queueName="XZ0.MBVM.U.SCHEDULE.CFG.01">
        <translation xmi:type="utility:ConstantString" string="UpdateConfigToMQ"/>
        <longDescription xmi:type="utility:ConstantString" string="Hier wird die Kofigurationsdatei zurück in die ursprüngliche Queue gesendet."/>
      </nodes>
      <nodes xmi:type="ErrorHandler.subflow:FCMComposite_1" xmi:id="FCMComposite_1_3" location="163,98">
        <translation xmi:type="utility:ConstantString" string="ErrorHandler"/>
      </nodes>
      <nodes xmi:type="ComIbmMQGet.msgnode:FCMComposite_1" xmi:id="FCMComposite_1_4" location="270,98" validateMaster="inherit">
        <translation xmi:type="utility:ConstantString" string="ReadConfigFromMQ"/>
      </nodes>
      <connections xmi:type="eflow:FCMConnection" xmi:id="FCMConnection_7" targetNode="FCMComposite_1_8" sourceNode="FCMComposite_1_6" sourceTerminalName="OutTerminal.out1" targetTerminalName="InTerminal.in"/>
      <connections xmi:type="eflow:FCMConnection" xmi:id="FCMConnection_2" targetNode="FCMComposite_1_7" sourceNode="FCMComposite_1_6" sourceTerminalName="OutTerminal.out" targetTerminalName="InTerminal.in"/>
      <connections xmi:type="eflow:FCMConnection" xmi:id="FCMConnection_9" targetNode="FCMComposite_1_3" sourceNode="FCMComposite_1_1" sourceTerminalName="OutTerminal.failure" targetTerminalName="InTerminal.Input2"/>
      <connections xmi:type="eflow:FCMConnection" xmi:id="FCMConnection_10" targetNode="FCMComposite_1_3" sourceNode="FCMComposite_1_1" sourceTerminalName="OutTerminal.out" targetTerminalName="InTerminal.Input"/>
      <connections xmi:type="eflow:FCMConnection" xmi:id="FCMConnection_11" targetNode="FCMComposite_1_3" sourceNode="FCMComposite_1_1" sourceTerminalName="OutTerminal.catch" targetTerminalName="InTerminal.Input1"/>
      <connections xmi:type="eflow:FCMConnection" xmi:id="FCMConnection_1" targetNode="FCMComposite_1_4" sourceNode="FCMComposite_1_3" sourceTerminalName="OutTerminal.Output" targetTerminalName="InTerminal.in"/>
      <connections xmi:type="eflow:FCMConnection" xmi:id="FCMConnection_3" targetNode="FCMComposite_1_6" sourceNode="FCMComposite_1_4" sourceTerminalName="OutTerminal.out" targetTerminalName="InTerminal.in"/>
    </composition>
    <propertyOrganizer>
      <propertyDescriptor groupName="Group.Basic" propertyEditor="com.ibm.etools.mft.ibmnodes.editors.mq.MQQueueNameEditor" configurable="true" describedAttribute="Property.ConfigQueue">
        <propertyName xmi:type="utility:TranslatableString" key="Property.ConfigQueue" bundleName="com/rockit/ip/scheduler/CronManager" pluginId="IIB-Scheduler"/>
      </propertyDescriptor>
    </propertyOrganizer>
    <attributeLinks promotedAttribute="Property.ConfigQueue" overriddenNodes="FCMComposite_1_8">
      <overriddenAttribute href="ComIbmMQOutput.msgnode#Property.queueName"/>
    </attributeLinks>
    <attributeLinks promotedAttribute="Property.ConfigQueue" overriddenNodes="FCMComposite_1_4">
      <overriddenAttribute href="ComIbmMQGet.msgnode#Property.queueName"/>
    </attributeLinks>
    <stickyBoard/>
  </eClassifiers>
</ecore:EPackage>
